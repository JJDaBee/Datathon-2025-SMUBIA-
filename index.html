<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Preloaded Network Diagram</title>

        <!-- Add Bootstrap for layout and styling -->
        <link
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <!-- Google Fonts for better typography -->
        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Roboto:wght@300;400&display=swap"
            rel="stylesheet"
        />

        <link href="styles.css" rel="stylesheet" />
    </head>
    <body>
        <h1>Network Diagram</h1>

        <div class="container">
            <!-- Network Diagram -->
            <div id="network"></div>
        </div>

        <!-- Load D3.js -->
        <script src="https://d3js.org/d3.v5.min.js"></script>

        <script>
            // Pre-given data for the network diagram
            const data = {
                nodes: [
                    { id: "Node1", name: "Node 1" },
                    { id: "Node2", name: "Node 2" },
                    { id: "Node3", name: "Node 3" },
                    { id: "Node4", name: "Node 4" },
                ],
                links: [
                    { source: "Node1", target: "Node2" },
                    { source: "Node2", target: "Node3" },
                    { source: "Node3", target: "Node4" },
                    { source: "Node4", target: "Node1" },
                ],
            };

            // Function to create the network diagram
            function createNetwork(data) {
                const width = 800;
                const height = 600;

                // Create the SVG container
                const svg = d3
                    .select('#network')
                    .append('svg')
                    .attr('width', width)
                    .attr('height', height);

                // Create the simulation
                const simulation = d3
                    .forceSimulation(data.nodes)
                    .force(
                        'link',
                        d3
                            .forceLink(data.links)
                            .id((d) => d.id)
                            .distance(150)
                    )
                    .force('charge', d3.forceManyBody().strength(-200))
                    .force('center', d3.forceCenter(width / 2, height / 2));

                // Add links (edges)
                const link = svg
                    .append('g')
                    .selectAll('.link')
                    .data(data.links)
                    .enter()
                    .append('line')
                    .attr('class', 'link')
                    .style('stroke', '#aaa')
                    .style('stroke-width', 2);

                // Add nodes (circles)
                const node = svg
                    .append('g')
                    .selectAll('.node')
                    .data(data.nodes)
                    .enter()
                    .append('circle')
                    .attr('class', 'node')
                    .attr('r', 20)
                    .style('fill', '#ff6347')
                    .call(
                        d3
                            .drag()
                            .on('start', dragstart)
                            .on('drag', dragged)
                            .on('end', dragend)
                    );

                // Add labels
                const label = svg
                    .append('g')
                    .selectAll('.label')
                    .data(data.nodes)
                    .enter()
                    .append('text')
                    .attr('class', 'label')
                    .attr('dx', 25)
                    .attr('dy', 5)
                    .text((d) => d.name);

                // Update positions on each simulation tick
                simulation.on('tick', () => {
                    link.attr('x1', (d) => d.source.x)
                        .attr('y1', (d) => d.source.y)
                        .attr('x2', (d) => d.target.x)
                        .attr('y2', (d) => d.target.y);

                    node.attr('cx', (d) => d.x).attr('cy', (d) => d.y);

                    label.attr('x', (d) => d.x).attr('y', (d) => d.y);
                });

                // Dragging functions
                function dragstart(event, d) {
                    if (!event.active) simulation.alphaTarget(0.3).restart();
                    d.fx = d.x;
                    d.fy = d.y;
                }

                function dragged(event, d) {
                    d.fx = event.x;
                    d.fy = event.y;
                }

                function dragend(event, d) {
                    if (!event.active) simulation.alphaTarget(0);
                    d.fx = null;
                    d.fy = null;
                }
            }

            // Call the function with the pre-given data
            createNetwork(data);
        </script>
    </body>
</html>
