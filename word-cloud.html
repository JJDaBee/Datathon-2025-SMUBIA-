<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Network Diagram with D3.js</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                text-align: center;
            }

            #network {
                width: 100%;
                height: 600px;
                border: 1px solid #ccc;
                margin-top: 20px;
            }
        </style>
    </head>
    <body>
        <h1>Network Diagram with D3.js</h1>

        <!-- This is where the network diagram will be rendered -->
        <div id="network"></div>

        <!-- Load D3.js -->
        <script src="https://d3js.org/d3.v5.min.js"></script>

        <!-- Your custom JavaScript will go here -->
        <script>
            // Create a simple dataset for the network diagram
            const nodes = [
                { id: 1, name: 'Node 1' },
                { id: 2, name: 'Node 2' },
                { id: 3, name: 'Node 3' },
                { id: 4, name: 'Node 4' },
            ];

            const links = [
                { source: 1, target: 2 },
                { source: 2, target: 3 },
                { source: 3, target: 4 },
                { source: 4, target: 1 },
            ];

            // Set up the dimensions for the SVG container
            const width = 800;
            const height = 600;

            // Create the SVG container where the network will be drawn
            const svg = d3
                .select('#network')
                .append('svg')
                .attr('width', width)
                .attr('height', height);

            // Create the simulation for force-directed layout
            const simulation = d3
                .forceSimulation(nodes)
                .force(
                    'link',
                    d3
                        .forceLink(links)
                        .id((d) => d.id)
                        .distance(150)
                )
                .force('charge', d3.forceManyBody().strength(-200))
                .force('center', d3.forceCenter(width / 2, height / 2));

            // Add links (edges) between nodes
            const link = svg
                .selectAll('.link')
                .data(links)
                .enter()
                .append('line')
                .attr('class', 'link')
                .style('stroke', '#aaa')
                .style('stroke-width', 2);

            // Add nodes (circles)
            const node = svg
                .selectAll('.node')
                .data(nodes)
                .enter()
                .append('circle')
                .attr('class', 'node')
                .attr('r', 20)
                .style('fill', '#ff6347')
                .call(
                    d3
                        .drag()
                        .on('start', dragstart)
                        .on('drag', dragged)
                        .on('end', dragend)
                );

            // Add labels to nodes
            const label = svg
                .selectAll('.label')
                .data(nodes)
                .enter()
                .append('text')
                .attr('class', 'label')
                .attr('dx', 25)
                .attr('dy', 5)
                .text((d) => d.name);

            // Update the positions of the nodes and links on each tick
            simulation.on('tick', () => {
                link.attr('x1', (d) => d.source.x)
                    .attr('y1', (d) => d.source.y)
                    .attr('x2', (d) => d.target.x)
                    .attr('y2', (d) => d.target.y);

                node.attr('cx', (d) => d.x).attr('cy', (d) => d.y);

                label.attr('x', (d) => d.x).attr('y', (d) => d.y);
            });

            // Drag functions to allow interaction with nodes
            function dragstart(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }

            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }

            function dragend(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }
        </script>
    </body>
</html>
